unit View.ConsultaCredencialAzul;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, REST.Types, REST.Client,
  Data.Bind.Components, Data.Bind.ObjectScope, System.JSON;

type
  TConsultaCredencialAzul = class(TForm)
    Label1: TLabel;
    EditIdentificador: TEdit;
    Label2: TLabel;
    EditSenha: TEdit;
    DadosRespostaAzul: TMemo;
    Label3: TLabel;
    BtnPesquisar: TButton;
    BtnLimpar: TButton;
    RESTClient1: TRESTClient;
    RESTRequest1: TRESTRequest;
    RESTResponse1: TRESTResponse;
    procedure FormKeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
    procedure BtnPesquisarClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  ConsultaCredencialAzul: TConsultaCredencialAzul;

implementation

{$R *.dfm}

procedure TConsultaCredencialAzul.BtnPesquisarClick(Sender: TObject);
var
  JSONBody: TJSONObject;
begin
  DadosRespostaAzul.Clear;

  RESTClient1.BaseURL := 'https://ediapi.onlineapp.com.br/apicoletor/api/Autenticacao';
  // Configurar o método HTTP para POST
  RESTRequest1.Method := TRESTRequestMethod.rmPOST;

  // Definir o tipo de conteúdo como JSON
  RESTRequest1.Params.Clear;
  RESTRequest1.Params.AddItem('body', '', TRESTRequestParameterKind.pkHTTPHEADER, [poDoNotEncode]);
  RESTRequest1.Params.ParameterByName('body').Value := 'application/json';

  // Criar um objeto JSON para o corpo da requisição
  JSONBody := TJSONObject.Create;
  try
    JSONBody.AddPair('identificacaoUsuario', EditIdentificador.Text);
    JSONBody.AddPair('password', EditSenha.Text);

    // Definir o corpo da requisição
    RESTRequest1.AddBody(JSONBody.ToString, TRESTContentType.ctAPPLICATION_JSON);

    // Executar a requisição
    RESTRequest1.Execute;


    if RESTResponse1.StatusCode = 200 then
    begin
      // Setar a responsta no Memo
      DadosRespostaAzul.Lines.Add(RESTRequest1.Response.JSONText);
    end
    else
    begin
      // Exibe a mensagem de erro se o status não for 200
      ShowMessage('Atenção: Autenticação Inválida! (Código: ' + IntToStr(RESTResponse1.StatusCode) + ')');
    end;

  finally
    JSONBody.Free;
  end;


end;

procedure TConsultaCredencialAzul.FormKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  if key = VK_ESCAPE then
    Close;
end;

end.
